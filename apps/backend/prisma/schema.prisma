// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id              String            @id @default(cuid())
  employeeId      String            @unique
  name            String
  email           String            @unique
  password        String // Hashed with bcryptjs
  role            Int               @default(0) // 0 = Staff, 1 = Admin
  department      String
  currentShift    String // e.g., "Morning", "Afternoon", "Night"
  status          String            @default("ACTIVE") // ACTIVE, INACTIVE, LEAVE
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  shiftAssignments ShiftAssignment[]
  swapRequests    ShiftSwap[]       @relation("Requester")
  swapsReceived   ShiftSwap[]       @relation("Colleague")
  attendanceRecords Attendance[]
}

model ShiftAssignment {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  shiftType String // "Morning", "Afternoon", "Night"
  date      DateTime
  startTime String // "06:00"
  endTime   String // "14:00"
  location  String
  notes     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, date]) // One assignment per user per day
}

model ShiftSwap {
  id             String    @id @default(cuid())
  requestDate    DateTime  @default(now())
  userId         String
  user           User      @relation("Requester", fields: [userId], references: [id], onDelete: Cascade)
  colleagueId    String?
  colleague      User?     @relation("Colleague", fields: [colleagueId], references: [id], onDelete: Cascade)
  requestedDate  DateTime
  currentShift   String // Staff's current shift on that date
  requestedShift String // What they want to swap to
  reason         String?
  status         String    @default("PENDING") // PENDING, APPROVED, REJECTED
  adminNotes     String?
  resolvedAt     DateTime?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
}

model Attendance {
  id           String    @id @default(cuid())
  userId       String
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  date         DateTime
  checkInTime  DateTime?
  checkOutTime DateTime?
  status       String // "ON_TIME", "LATE", "ABSENT", "PRESENT"
  location     String?
  notes        String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  @@unique([userId, date])
}
